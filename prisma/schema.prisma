// Aurora Horizon RP - CAD System Database Schema
// Inspired by Sonoran CAD

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================
// USER & AUTHENTICATION
// ============================================

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  emailVerified DateTime?
  image         String?
  role          String    @default("user") // user, admin
  discordId     String?   @unique
  discordUsername String?
  bio           String?   @default("")
  bannerImage   String?   // Profile banner/cover photo
  badges        String?   // JSON array of badge IDs
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // CAD Relations
  officers      Officer[]
  createdCalls  Call[]    @relation("CallCreator")
  callTemplates CallTemplate[] @relation("TemplateCreator")
  characters    Character[]
  
  // Community Features
  applications  Application[]
  messages      Message[]     @relation("MessageSender")
  receivedMessages Message[]  @relation("MessageReceiver")
  eventRSVPs    EventRSVP[]
  whitelistEntry WhitelistEntry?
  statistics    UserStatistics?
}

// ============================================
// CHARACTER SYSTEM
// ============================================

model Character {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  firstName     String
  lastName      String
  dateOfBirth   String   // Store as string for flexibility
  gender        String   // MALE, FEMALE, OTHER
  
  // Physical Appearance
  height        String?  // e.g., "6'2\"" or "188cm"
  weight        String?  // e.g., "180lbs" or "82kg"
  eyeColor      String?  // Brown, Blue, Green, Hazel, etc.
  hairColor     String?  // Black, Brown, Blonde, Red, etc.
  build         String?  // Slim, Athletic, Muscular, Heavy, etc.
  distinguishingFeatures String? // Tattoos, scars, piercings
  
  image         String?  // Character photo/avatar
  backstory     String?  // Rich text backstory
  
  // Identification
  stateId       String?  // Auto-generated or custom ID number
  bloodType     String?  // A+, A-, B+, B-, AB+, AB-, O+, O-
  licenseStatus String   @default("NONE") // NONE, VALID, SUSPENDED, REVOKED
  firearmPermit Boolean  @default(false) // Has firearm/concealed carry permit
  organDonor    Boolean  @default(false) // Organ donor status
  veteranStatus Boolean  @default(false) // Military veteran status
  
  // Medical Information
  allergies     String?  // Known allergies (for medical scenarios)
  medicalConditions String? // Chronic conditions, disabilities
  
  // Employment
  occupation    String?  // Job/profession
  department    String?  // POLICE, FIRE, EMS, CIVILIAN
  rank          String?  // Officer rank or position
  
  // Contact & Background
  phoneNumber   String?
  placeOfBirth  String?  // City, State
  nationality   String?  // Country
  education     String?  // High School, College, etc.
  
  // Personality & Skills (JSON strings)
  personalityTraits String? // JSON array: ["Friendly", "Aggressive"]
  skills        String?  // JSON object: {"driving": 75, "shooting": 50}
  
  isActive      Boolean  @default(true)
  isApproved    Boolean  @default(false)
  
  playTime      Int      @default(0) // Minutes played
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  // Police Record Relations
  characterNotes  CharacterNote[]
  characterFlags  CharacterFlag[]
  characterWarrants CharacterWarrant[]
  characterCitations CharacterCitation[]
  characterArrests CharacterArrest[]
  
  @@index([userId])
  @@index([firstName, lastName])
}

// ============================================
// CHARACTER POLICE RECORDS
// ============================================

model CharacterNote {
  id          String   @id @default(cuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  title       String
  content     String
  category    String?  // GENERAL, INCIDENT, CONTACT, INTELLIGENCE
  
  createdBy   String   // Officer name or user ID
  source      String   @default("user") // "user" or "cad"
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([characterId])
  @@index([source])
}

model CharacterFlag {
  id          String   @id @default(cuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  flagType    String   // ARMED, VIOLENT, GANG, CAUTION, MENTAL, SUICIDAL, BOLO
  reason      String?
  severity    String   @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  
  isActive    Boolean  @default(true)
  expiresAt   DateTime?
  
  createdBy   String
  source      String   @default("cad") // "user" or "cad" - flags are usually CAD-sourced
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([characterId])
  @@index([source])
  @@index([isActive])
}

model CharacterWarrant {
  id          String   @id @default(cuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  offense     String
  description String?
  bail        Int?
  
  isActive    Boolean  @default(true)
  issuedAt    DateTime @default(now())
  issuedBy    String
  
  source      String   @default("cad") // "user" or "cad"
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([characterId])
  @@index([source])
  @@index([isActive])
}

model CharacterCitation {
  id          String   @id @default(cuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  violation   String
  fine        Int
  notes       String?
  location    String?
  
  isPaid      Boolean  @default(false)
  issuedAt    DateTime @default(now())
  issuedBy    String
  
  source      String   @default("user") // "user" or "cad"
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([characterId])
  @@index([source])
  @@index([isPaid])
}

model CharacterArrest {
  id          String   @id @default(cuid())
  characterId String
  character   Character @relation(fields: [characterId], references: [id], onDelete: Cascade)
  
  charges     String   // JSON array of charges
  narrative   String?
  location    String?
  
  arrestedAt  DateTime @default(now())
  arrestedBy  String
  
  source      String   @default("user") // "user" or "cad"
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([characterId])
  @@index([source])
}

// ============================================
// APPLICATIONS & RECRUITMENT
// ============================================

model Application {
  id            String   @id @default(cuid())
  userId        String?  // Optional - for logged-in users
  user          User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Application Type
  applicationType String // whitelist, police, ems, fire
  
  // Dynamic Form Data - JSON object with all form field values
  formData      String   // JSON string of all submitted field values
  
  // Status & Review
  status        String   @default("DRAFT") // DRAFT, PENDING, UNDER_REVIEW, APPROVED, REJECTED
  isDraft       Boolean  @default(true)    // Quick flag for drafts
  
  // Review Information
  reviewedBy    String?  // Admin user ID
  reviewedAt    DateTime?
  reviewNotes   String?
  feedback      String?  // Feedback for applicant
  
  // Metadata
  submittedDate DateTime?
  lastSavedAt   DateTime @default(now())  // Auto-save timestamp
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([status])
  @@index([applicationType])
  @@index([isDraft])
  @@index([userId, isDraft])
}

// ============================================
// APPLICATION FORM CONFIGURATION
// ============================================

model ApplicationFormConfig {
  id            String   @id @default(cuid())
  name          String   // whitelist, police, ems, fire
  title         String   // Display title
  description   String?  // Form description
  isActive      Boolean  @default(true)
  
  fields        ApplicationFormField[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([name])
}

model ApplicationFormField {
  id            String   @id @default(cuid())
  formConfigId  String
  formConfig    ApplicationFormConfig @relation(fields: [formConfigId], references: [id], onDelete: Cascade)
  
  // Field Configuration
  fieldName     String   // Unique identifier (e.g., "discordUsername")
  label         String   // Display label
  fieldType     String   // text, textarea, select, radio, checkbox, number, email
  placeholder   String?  // Placeholder text
  helpText      String?  // Help text below field
  
  // Validation
  required      Boolean  @default(false)
  minLength     Int?
  maxLength     Int?
  pattern       String?  // Regex pattern for validation
  
  // Options for select/radio/checkbox
  options       String?  // JSON array of options
  
  // Layout
  order         Int      @default(0)
  width         String   @default("full") // full, half
  section       String?  // Group fields into sections
  
  // Conditional Logic
  conditionalLogic String? // JSON: {show: true/false, conditions: [{field: "fieldName", operator: "equals", value: "x"}], operator: "AND"/"OR"}
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([formConfigId])
  @@index([order])
}

// ============================================
// WHITELIST & SERVER ACCESS
// ============================================

model WhitelistEntry {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  steamId       String?  @unique
  discordId     String?
  
  status        String   @default("PENDING") // PENDING, APPROVED, DENIED, BANNED
  priority      Int      @default(0) // Queue priority level
  
  approvedBy    String?
  approvedAt    DateTime?
  
  // Moderation
  banReason     String?
  bannedAt      DateTime?
  kickHistory   String?  // JSON array of kick records
  warnHistory   String?  // JSON array of warnings
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([steamId])
  @@index([status])
}

// ============================================
// MESSAGING SYSTEM
// ============================================

model Message {
  id            String   @id @default(cuid())
  
  senderId      String
  sender        User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  
  receiverId    String?
  receiver      User?    @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  
  type          String   @default("DIRECT") // DIRECT, GROUP, ANNOUNCEMENT
  groupId       String?  // For group chats
  
  subject       String?
  content       String
  
  isRead        Boolean  @default(false)
  readAt        DateTime?
  
  attachments   String?  // JSON array of attachment URLs
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([senderId])
  @@index([receiverId])
  @@index([groupId])
  @@index([isRead])
}

// ============================================
// EVENTS & CALENDAR
// ============================================

model Event {
  id            String   @id @default(cuid())
  
  title         String
  description   String?
  
  type          String   // SERVER_EVENT, RACE, ROBBERY, MEETING, PATROL, OTHER
  department    String?  // POLICE, FIRE, EMS, ALL, null for community events
  
  startTime     DateTime
  endTime       DateTime?
  
  location      String?  // In-game location
  
  isRecurring   Boolean  @default(false)
  recurrence    String?  // DAILY, WEEKLY, MONTHLY
  
  maxAttendees  Int?     // Capacity limit
  requiresRSVP  Boolean  @default(false)
  
  createdBy     String
  
  rsvps         EventRSVP[]
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([startTime])
  @@index([type])
  @@index([department])
}

model EventRSVP {
  id            String   @id @default(cuid())
  
  eventId       String
  event         Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  status        String   @default("GOING") // GOING, MAYBE, NOT_GOING
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

// ============================================
// STATISTICS & ANALYTICS
// ============================================

model UserStatistics {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Playtime
  totalMinutes  Int      @default(0)
  monthlyMinutes String? // JSON object by month
  
  // Department Stats
  arrestsMade   Int      @default(0)
  callsResponded Int     @default(0)
  patientsTreated Int    @default(0)
  firesExtinguished Int  @default(0)
  
  // Activity
  lastSeen      DateTime @default(now())
  loginStreak   Int      @default(0)
  
  // Reputation
  commendations Int      @default(0)
  warnings      Int      @default(0)
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// ============================================
// DEPARTMENT CONFIGURATION
// ============================================

model Department {
  id                    String    @id @default(cuid())
  name                  String    @unique // POLICE, FIRE, EMS
  displayName           String    // Aurora Horizon Police Department
  motto                 String?   // To Protect and Serve
  description           String?   // Department description
  homepageContent       String?   // Markdown content for homepage
  
  // Theme
  primaryColor          String    @default("#3B82F6")
  secondaryColor        String    @default("#2563EB")
  accentColor           String    @default("#1D4ED8")
  logoUrl               String?
  badgeUrl              String?
  bannerUrl             String?
  customCSS             String?
  enableGradient        Boolean   @default(true)
  gradientDirection     String    @default("to right")
  borderStyle           String    @default("solid")
  cardOpacity           Float     @default(0.5)
  
  // Settings
  enabled               Boolean   @default(true)
  maxUnits              Int       @default(20)
  requireCertification  Boolean   @default(false)
  autoApprove           Boolean   @default(false)
  allowRecruitment      Boolean   @default(true)
  minPlaytime           Int       @default(0)
  discordRole           String?
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
  
  // Relations
  stations              Station[]
  divisions             Division[]
  ranks                 Rank[]
  members               Member[]
}

model Station {
  id              String     @id @default(cuid())
  departmentId    String
  department      Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
  name            String
  address         String?
  phone           String?
  staffCount      Int        @default(0)
  status          String     @default("Active") // Active, Inactive, Under Construction
  imageUrl        String?
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  
  @@index([departmentId])
}

model Division {
  id              String     @id @default(cuid())
  departmentId    String
  department      Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
  name            String
  icon            String?    // Icon name from lucide-react
  memberCount     Int        @default(0)
  description     String?
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  
  @@index([departmentId])
}

model Rank {
  id              String     @id @default(cuid())
  departmentId    String
  department      Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
  name            String
  abbreviation    String?
  level           Int        // 1 = lowest, higher = more senior
  permissions     String?    // JSON array of permissions
  payGrade        Int?
  color           String?    // For UI display
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  
  // Relations
  members         Member[]
  
  @@index([departmentId])
  @@index([level])
}

model Member {
  id              String     @id @default(cuid())
  departmentId    String
  department      Department @relation(fields: [departmentId], references: [id], onDelete: Cascade)
  
  rankId          String
  rank            Rank       @relation(fields: [rankId], references: [id])
  
  name            String
  badgeNumber     String?
  status          String     @default("active") // active, loa, suspended, terminated
  joinDate        DateTime   @default(now())
  certifications  String?    // JSON array of certifications
  
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  
  @@index([departmentId])
  @@index([rankId])
}

// ============================================
// EMERGENCY SERVICES
// ============================================

// Note: SQLite doesn't support enums, so we use String fields with default values
// Valid values for department: POLICE, FIRE, EMS
// Valid values for unitStatus: AVAILABLE, BUSY, ENROUTE, ON_SCENE, OUT_OF_SERVICE, PANIC
// Valid values for callPriority: LOW, MEDIUM, HIGH, CRITICAL
// Valid values for callStatus: PENDING, DISPATCHED, ACTIVE, CLOSED, CANCELLED
// Valid values for callType: See list below

// ============================================
// OFFICERS & UNITS
// ============================================

model Officer {
  id          String     @id @default(cuid())
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  callsign    String     @unique
  name        String
  badge       String?
  department  String     // POLICE, FIRE, EMS
  rank        String?
  
  isActive    Boolean    @default(true)
  dutyStatus  String     @default("OUT_OF_SERVICE") // AVAILABLE, BUSY, ENROUTE, ON_SCENE, OUT_OF_SERVICE, PANIC
  
  // Tactical Team Fields
  isTactical  Boolean    @default(false)
  tacticalTeam String?   // CIRT, SOG
  tacticalRole String?   // TEAM_LEADER, BREACHER, SNIPER, NEGOTIATOR, MEDIC, K9_HANDLER, EXPLOSIVES, ENTRY_TEAM
  qualifications String? // JSON array of certifications
  lastTraining DateTime?
  responseTime Int?      // Expected response time in minutes
  equipment    String?   // JSON array of assigned equipment
  phone        String?
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  unitId      String?
  unit        Unit?      @relation(fields: [unitId], references: [id])
  callNotes   CallNote[]
  plateScans  PlateScan[]
  tacticalCallouts TacticalCallout[] @relation("TacticalCalloutOfficer")
}

model Unit {
  id          String     @id @default(cuid())
  callsign    String     @unique
  department  String     // POLICE, FIRE, EMS
  unitType    String?    // PATROL, TRAFFIC, K9, SWAT, ENGINE, LADDER, HAZMAT, AMBULANCE, MEDIC, etc.
  status      String     @default("OUT_OF_SERVICE") // AVAILABLE, BUSY, ENROUTE, ON_SCENE, OUT_OF_SERVICE, PANIC
  statusCode  String?    // Department-specific status codes (10-8, RESPONDING, PATIENT_CONTACT, etc.)
  
  // Current assignment
  callId      String?
  call        Call?      @relation(fields: [callId], references: [id])
  
  // Location & Zone
  location    String?
  latitude    Float?
  longitude   Float?
  zone        String?    // Geographic zone assignment (NORTH, SOUTH, EAST, WEST, CENTRAL)
  
  // Response tracking
  responseTime Int?      // Minutes to respond to scene
  lastStatusChange DateTime? // When status last changed
  
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt

  // Relations
  officers    Officer[]
  plateScans  PlateScan[]
  equipment   Equipment[] @relation("EquipmentUnit")
}

// ============================================
// CALLS & DISPATCH
// ============================================

model Call {
  id          String       @id @default(cuid())
  callNumber  String       @unique // Auto-generated CAD number (e.g., 2025-001234)
  
  type        String       // TRAFFIC_STOP, SUSPICIOUS_ACTIVITY, THEFT, ROBBERY, ASSAULT, etc.
  priority    String       @default("MEDIUM") // Department-specific priorities
  status      String       @default("PENDING") // PENDING, DISPATCHED, ACTIVE, CLOSED, CANCELLED
  department  String?      // POLICE, FIRE, EMS - which department owns this call
  
  // Location & Zone
  location    String
  latitude    Float?
  longitude   Float?
  postal      String?
  zone        String?      // Geographic zone (NORTH, SOUTH, EAST, WEST, CENTRAL)
  
  // Details
  description String
  caller      String?
  callerPhone String?
  
  // FIRE Department Specific Fields
  fireSize    String?      // SMALL, MEDIUM, LARGE, MAJOR
  hazmat      Boolean      @default(false) // HAZMAT involvement flag
  alarmLevel  String?      // FIRST_ALARM, SECOND_ALARM, THIRD_ALARM
  
  // EMS Department Specific Fields
  patientAge  Int?
  patientGender String?    // MALE, FEMALE, OTHER, UNKNOWN
  consciousness String?    // ALERT, VERBAL, PAIN, UNRESPONSIVE
  
  // Response Time Tracking
  responseTimeTarget Int? // Target response time in minutes
  actualResponseTime Int? // Actual response time in minutes
  
  // Cross-Department Coordination
  requiresMutualAid Boolean @default(false)
  notifiedDepartments String? // JSON array of departments notified
  
  // Escalation
  escalated   Boolean      @default(false)
  escalatedFrom String?    // Original call ID if escalated
  escalatedTo String?      // Priority level escalated to
  
  // Timestamps
  createdAt   DateTime     @default(now())
  dispatchedAt DateTime?
  closedAt    DateTime?
  
  // Creator
  createdById String
  createdBy   User         @relation("CallCreator", fields: [createdById], references: [id])
  
  // Relations
  units       Unit[]
  notes       CallNote[]
  attachments CallAttachment[]
  tacticalCallouts TacticalCallout[]
  
  @@index([status, priority])
  @@index([createdAt])
  @@index([department])
  @@index([zone])
}

model CallNote {
  id        String   @id @default(cuid())
  callId    String
  call      Call     @relation(fields: [callId], references: [id], onDelete: Cascade)
  
  officerId String
  officer   Officer  @relation(fields: [officerId], references: [id])
  
  content   String
  createdAt DateTime @default(now())
}

// Tactical Team Callout System
model TacticalCallout {
  id            String   @id @default(cuid())
  calloutTime   DateTime @default(now())
  incidentType  String   // HOSTAGE, BARRICADED_SUSPECT, ACTIVE_SHOOTER, HIGH_RISK_WARRANT, etc.
  location      String
  priority      String   @default("URGENT") // ROUTINE, URGENT, CRITICAL
  status        String   @default("PENDING") // PENDING, RESPONDING, ON_SCENE, RESOLVED
  team          String   // CIRT, SOG, BOTH
  
  requestedBy   String
  approvedBy    String?
  briefing      String?  // Tactical briefing notes
  stagingArea   String?  // Designated staging location
  
  // Relations
  officers      Officer[] @relation("TacticalCalloutOfficer")
  
  // Associated CAD call (if any)
  callId        String?
  call          Call?    @relation(fields: [callId], references: [id])
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@index([status])
  @@index([team])
}

model CallAttachment {
  id        String   @id @default(cuid())
  callId    String
  call      Call     @relation(fields: [callId], references: [id], onDelete: Cascade)
  
  filename  String
  url       String
  type      String   // image, video, document
  createdAt DateTime @default(now())
}

model CallTemplate {
  id          String   @id @default(cuid())
  name        String
  description String
  callType    String   // Pre-filled call type
  priority    String   // Default priority
  department  String   // POLICE, FIRE, EMS
  
  // Pre-filled content
  descriptionTemplate String // Template text with placeholders
  
  // Usage tracking
  usageCount  Int      @default(0)
  isPublic    Boolean  @default(false) // Available to all users in department
  
  createdById String
  createdBy   User     @relation("TemplateCreator", fields: [createdById], references: [id])
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([department])
}

model Equipment {
  id          String   @id @default(cuid())
  name        String
  type        String   // K9_UNIT, HELICOPTER, FOAM_UNIT, DEFIBRILLATOR, etc.
  department  String   // POLICE, FIRE, EMS
  status      String   @default("AVAILABLE") // AVAILABLE, IN_USE, MAINTENANCE, OUT_OF_SERVICE
  
  // Assignment
  assignedToUnitId String?
  assignedToUnit   Unit?    @relation("EquipmentUnit", fields: [assignedToUnitId], references: [id])
  
  // Location
  location    String?
  
  // Tracking
  lastInspection DateTime?
  nextInspection DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([department])
  @@index([status])
}

// Add Equipment relation to Unit model (Note: This requires updating Unit model)
// Unit model needs: equipment Equipment[] @relation("EquipmentUnit")

// ============================================
// CIVIL RECORDS
// ============================================

model Citizen {
  id          String    @id @default(cuid())
  
  // Personal Info
  firstName   String
  lastName    String
  dateOfBirth DateTime
  gender      String?
  
  // Identification
  stateId     String?   @unique
  phoneNumber String?
  address     String?
  
  // Status
  isWanted    Boolean   @default(false)
  isMissing   Boolean   @default(false)
  flags       String?   // JSON array of flags: ["armed", "violent", "gang", "caution", "mental", "suicidal"]
  notes       String?   // JSON array of officer notes with timestamps
  
  // Additional Information
  aliases     String?   // JSON array of known aliases
  tattoos     String?   // Text description of tattoos/scars/marks
  image       String?   // Photo URL
  
  // Emergency & Medical
  emergencyContact String?  // JSON object: {name, relationship, phone}
  medicalInfo     String?   // JSON array of medical alerts: [{type: "allergy/medication/condition", detail: "..."}]
  
  // Gang Information
  gangAffiliation String?  // Gang name
  gangStatus      String?  // "verified", "suspected", "former"
  gangNotes       String?  // Additional gang intelligence
  
  // Licenses
  driversLicense Boolean @default(false)
  weaponsPermit  Boolean @default(false)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  // Relations
  vehicles    Vehicle[]
  warrants    Warrant[]
  citations   Citation[]
  arrests     Arrest[]
}

model Vehicle {
  id          String   @id @default(cuid())
  
  plate       String   @unique
  model       String
  color       String
  year        Int?
  vin         String?  // Vehicle Identification Number
  make        String?  // Manufacturer (e.g., Honda, Ford)
  
  isStolen    Boolean  @default(false)
  isWanted    Boolean  @default(false)
  isImpounded Boolean  @default(false)
  
  // Registration & Insurance
  registrationStatus String @default("VALID") // VALID, EXPIRED, SUSPENDED, NONE
  insuranceStatus    String @default("VALID") // VALID, EXPIRED, NONE
  insuranceCompany   String?
  insurancePolicy    String?
  
  // Owner
  ownerId     String
  owner       Citizen  @relation(fields: [ownerId], references: [id])
  
  // Registration
  registeredAt DateTime @default(now())
  expiresAt    DateTime?
  
  // Notes and History
  notes       String?  // JSON array of officer notes
  flags       String?  // JSON array of flags (stolen, wanted, etc.)
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  plateScans  PlateScan[]
}

model Warrant {
  id          String   @id @default(cuid())
  
  citizenId   String
  citizen     Citizen  @relation(fields: [citizenId], references: [id])
  
  offense     String
  description String?
  bail        Int?
  
  isActive    Boolean  @default(true)
  issuedAt    DateTime @default(now())
  issuedBy    String
  
  source      String   @default("cad") // "user" or "cad" - determines edit permissions
  
  createdAt   DateTime @default(now())
}

model Citation {
  id          String   @id @default(cuid())
  
  citizenId   String
  citizen     Citizen  @relation(fields: [citizenId], references: [id])
  
  violation   String
  fine        Int
  notes       String?
  
  isPaid      Boolean  @default(false)
  issuedAt    DateTime @default(now())
  issuedBy    String
  
  source      String   @default("cad") // "user" or "cad" - determines edit permissions
  
  createdAt   DateTime @default(now())
}

model Arrest {
  id          String   @id @default(cuid())
  
  citizenId   String
  citizen     Citizen  @relation(fields: [citizenId], references: [id])
  
  charges     String
  notes       String?
  
  arrestedAt  DateTime @default(now())
  arrestedBy  String
  
  source      String   @default("cad") // "user" or "cad" - determines edit permissions
  
  createdAt   DateTime @default(now())
}

// ============================================
// PLATE SCANNER / ALPR SYSTEM
// ============================================

model PlateScan {
  id          String   @id @default(cuid())
  
  plate       String
  camera      String   // front, rear, manual, wars2x
  location    String?
  result      String   @default("CHECKED") // CHECKED, BOLO_HIT, STOLEN, WANTED, CLEAR
  
  // Officer who scanned
  officerId   String
  officer     Officer  @relation(fields: [officerId], references: [id])
  
  // Unit that scanned
  unitId      String?
  unit        Unit?    @relation(fields: [unitId], references: [id])
  
  // Vehicle if found in database
  vehicleId   String?
  vehicle     Vehicle? @relation(fields: [vehicleId], references: [id])
  
  scannedAt   DateTime @default(now())
  
  @@index([plate, scannedAt])
  @@index([officerId, scannedAt])
}

// ============================================
// PANIC ALERTS & EMERGENCY
// ============================================

model PanicAlert {
  id          String   @id @default(cuid())
  
  unitId      String
  unitCallsign String
  department  String   // POLICE, FIRE, EMS
  
  location    String?
  latitude    Float?
  longitude   Float?
  
  reason      String?  // Optional reason/description
  status      String   @default("ACTIVE") // ACTIVE, RESPONDED, CANCELLED, RESOLVED
  
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
  
  @@index([status, createdAt])
}

// ============================================
// BOLO SYSTEM (Be On the Lookout)
// ============================================

model BOLO {
  id          String   @id @default(cuid())
  
  type        String   // PERSON, VEHICLE, OTHER
  title       String
  description String
  
  // Person details (if applicable)
  personName  String?
  personDesc  String?
  
  // Vehicle details (if applicable)
  vehiclePlate String?
  vehicleModel String?
  vehicleColor String?
  
  // Image
  imageUrl    String?
  
  priority    String   @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  status      String   @default("ACTIVE") // ACTIVE, CANCELLED, RESOLVED
  
  issuedBy    String
  issuedAt    DateTime @default(now())
  expiresAt   DateTime?
  resolvedAt  DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status, priority])
}

// ============================================
// BACKUP REQUESTS
// ============================================

model BackupRequest {
  id          String   @id @default(cuid())
  
  requestingUnitId String
  requestingUnit   String // Callsign
  department       String // POLICE, FIRE, EMS
  
  callId      String?
  callNumber  String?
  
  location    String
  latitude    Float?
  longitude   Float?
  
  urgency     String   @default("ROUTINE") // ROUTINE, URGENT, EMERGENCY
  reason      String?
  
  status      String   @default("PENDING") // PENDING, ACKNOWLEDGED, ENROUTE, ARRIVED, CANCELLED
  
  requestedAt DateTime @default(now())
  respondedAt DateTime?
  
  @@index([status, urgency])
}

// ============================================
// NOTIFICATIONS
// ============================================

model Notification {
  id          String   @id @default(cuid())
  
  userId      String
  
  type        String   // PANIC, BACKUP, BOLO, CALL, WARRANT, SYSTEM
  title       String
  message     String
  
  priority    String   @default("NORMAL") // LOW, NORMAL, HIGH, CRITICAL
  
  isRead      Boolean  @default(false)
  
  // Reference IDs (optional)
  referenceId   String?
  referenceType String?  // call, unit, bolo, warrant, etc.
  
  createdAt   DateTime @default(now())
  
  @@index([userId, isRead])
  @@index([createdAt])
}

// ============================================
// 10-CODES & QUICK STATUS
// ============================================

model StatusCode {
  id          String   @id @default(cuid())
  
  code        String   @unique // 10-4, 10-8, 10-23, etc.
  meaning     String
  department  String?  // null for universal codes, or POLICE/FIRE/EMS for specific
  category    String?  // acknowledgment, status, emergency, etc.
  
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
}

model StatusLog {
  id          String   @id @default(cuid())
  
  unitId      String
  unitCallsign String
  
  code        String   // The 10-code used
  status      String   // The status change
  
  callId      String?
  
  createdAt   DateTime @default(now())
  
  @@index([unitId, createdAt])
}

// ============================================
// DISPATCHER COORDINATION
// ============================================

model DispatcherSession {
  id          String   @id @default(cuid())
  
  userId      String
  name        String
  
  status      String   @default("ACTIVE") // ACTIVE, BREAK, OFFLINE
  
  startedAt   DateTime @default(now())
  endedAt     DateTime?
  
  @@index([status])
}

model DispatcherMessage {
  id          String   @id @default(cuid())
  
  fromUserId  String
  fromName    String
  fromCallsign String?
  
  toUserId    String?  // null for broadcast
  
  message     String
  priority    String   @default("NORMAL") // NORMAL, HIGH, URGENT
  
  // Channel & Category system
  channel     String?  @default("general") // general, operations, admin, shifts
  category    String?  // traffic, medical, fire, admin, update
  
  // Advanced features
  mentions    String?  // JSON array of mentioned user IDs
  parentId    String?  // For threaded replies
  threadId    String?  // Thread identifier
  expiresAt   DateTime? // Auto-delete timestamp
  department  String?  // POLICE, FIRE, EMS
  
  // Message status
  isRead      Boolean  @default(false)
  isPinned    Boolean  @default(false)
  
  // Reactions & Edit history
  reactions   String?  // JSON array of {emoji, userId, userName}
  editedAt    DateTime? // Last edit timestamp
  
  // Attachments
  attachmentUrl  String?
  attachmentType String? // image, document, etc.
  
  // Metadata
  callNumber  String?  // Link to CAD call
  location    String?  // Location reference
  
  createdAt   DateTime @default(now())
  
  @@index([toUserId, isRead])
  @@index([channel])
  @@index([category])
  @@index([threadId])
  @@index([callNumber])
}

// Message Bookmarks
model MessageBookmark {
  id        String   @id @default(cuid())
  userId    String
  messageId String
  createdAt DateTime @default(now())
  
  @@unique([userId, messageId])
  @@index([userId])
}

// Message Templates
model MessageTemplate {
  id         String   @id @default(cuid())
  userId     String
  name       String
  text       String
  category   String?
  department String?
  isPublic   Boolean  @default(false) // Share with department
  createdAt  DateTime @default(now())
  
  @@index([userId])
  @@index([department])
}

// Read Receipts
model MessageReadReceipt {
  id        String   @id @default(cuid())
  messageId String
  userId    String
  userName  String
  readAt    DateTime @default(now())
  
  @@unique([messageId, userId])
  @@index([messageId])
}

// ============================================
// MAPPING & LOCATION
// ============================================

model Zone {
  id          String   @id @default(cuid())
  name        String   @unique
  type        String   // PATROL, DISTRICT, JURISDICTION
  department  String?  // POLICE, FIRE, EMS, or null for shared
  
  // Polygon coordinates (JSON string of lat/lng points)
  coordinates String
  color       String   @default("#3b82f6")
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
}

model PointOfInterest {
  id          String   @id @default(cuid())
  name        String
  type        String   // HOSPITAL, POLICE_STATION, FIRE_STATION, LANDMARK
  address     String
  latitude    Float
  longitude   Float
  
  description String?
  icon        String?
  
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  
  @@index([type])
}

// ============================================
// PERSONNEL MANAGEMENT
// ============================================

model OfficerProfile {
  id          String   @id @default(cuid())
  officerId   String   @unique
  
  // Personal Info
  firstName   String
  lastName    String
  badgeNumber String   @unique
  
  // Department Info
  department  String   // POLICE, FIRE, EMS
  rank        String
  division    String?  // Patrol, Detective, SWAT, etc.
  
  // Status
  hireDate    DateTime
  isActive    Boolean  @default(true)
  
  // Certifications & Training
  certifications String? // JSON array
  specializations String? // JSON array
  
  // Statistics
  totalCalls      Int @default(0)
  totalArrests    Int @default(0)
  totalCitations  Int @default(0)
  hoursLogged     Float @default(0)
  
  // Avatar
  avatarUrl   String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  // Relations
  trainingRecords TrainingRecord[]
  shiftLogs       ShiftLog[]
}

model TrainingRecord {
  id          String   @id @default(cuid())
  officerId   String
  officer     OfficerProfile @relation(fields: [officerId], references: [id], onDelete: Cascade)
  
  trainingType    String // FIREARMS, DRIVING, FIRST_AID, SWAT, K9, etc.
  certificationName String
  completedDate   DateTime
  expiresAt       DateTime?
  
  instructor      String?
  notes           String?
  
  createdAt   DateTime @default(now())
  
  @@index([officerId])
}

model ShiftLog {
  id          String   @id @default(cuid())
  officerId   String
  officer     OfficerProfile @relation(fields: [officerId], references: [id], onDelete: Cascade)
  
  clockIn     DateTime
  clockOut    DateTime?
  
  hoursWorked Float    @default(0)
  callsHandled Int     @default(0)
  
  notes       String?
  
  createdAt   DateTime @default(now())
  
  @@index([officerId, clockIn])
}

// ============================================
// FLEET MANAGEMENT
// ============================================

model FleetVehicle {
  id          String   @id @default(cuid())
  
  callsign    String   @unique // CAR-12, TRUCK-5, etc.
  type        String   // PATROL_CAR, SUV, TRUCK, AMBULANCE, FIRE_ENGINE
  department  String   // POLICE, FIRE, EMS
  
  make        String
  model       String
  year        Int
  plate       String   @unique
  vin         String?
  
  status      String   @default("AVAILABLE") // AVAILABLE, IN_USE, MAINTENANCE, OUT_OF_SERVICE
  mileage     Int      @default(0)
  
  lastMaintenance DateTime?
  nextMaintenance DateTime?
  
  assignedUnitId String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  maintenanceLogs MaintenanceLog[]
  
  @@index([department, status])
}

model MaintenanceLog {
  id          String   @id @default(cuid())
  vehicleId   String
  vehicle     FleetVehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  
  type        String   // OIL_CHANGE, TIRE_ROTATION, REPAIR, INSPECTION
  description String
  cost        Float    @default(0)
  
  performedBy String
  performedAt DateTime @default(now())
  
  createdAt   DateTime @default(now())
  
  @@index([vehicleId])
}

// ============================================
// EXTENDED CIVIL RECORDS
// ============================================

model Property {
  id          String   @id @default(cuid())
  
  address     String   @unique
  ownerName   String
  ownerId     String?  // Link to Citizen if exists
  
  propertyType String  // RESIDENTIAL, COMMERCIAL, INDUSTRIAL, VACANT
  value       Float?
  
  latitude    Float?
  longitude   Float?
  
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([ownerName])
}

model BusinessLicense {
  id          String   @id @default(cuid())
  
  businessName String
  ownerName    String
  ownerId      String? // Link to Citizen
  
  licenseNumber String  @unique
  licenseType   String  // RESTAURANT, RETAIL, FIREARMS_DEALER, etc.
  
  address       String
  isActive      Boolean @default(true)
  
  issuedDate    DateTime
  expiresAt     DateTime?
  
  notes         String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([businessName])
}

model FirearmRegistry {
  id          String   @id @default(cuid())
  
  ownerName   String
  ownerId     String?  // Link to Citizen
  
  serialNumber String  @unique
  make        String
  model       String
  caliber     String
  type        String   // HANDGUN, RIFLE, SHOTGUN
  
  isStolen    Boolean  @default(false)
  registrationDate DateTime
  
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([ownerName])
  @@index([serialNumber])
}

// ============================================
// INCIDENT REPORTS & COURT
// ============================================

model IncidentReport {
  id          String   @id @default(cuid())
  
  reportNumber String  @unique // IR-2025-001234
  callId       String?
  
  type        String   // ARREST, ACCIDENT, INCIDENT, INVESTIGATION
  title       String
  narrative   String
  
  location    String
  occurredAt  DateTime
  
  reportedBy  String   // Officer name/callsign
  approvedBy  String?
  
  status      String   @default("DRAFT") // DRAFT, SUBMITTED, APPROVED, ARCHIVED
  
  // Involved parties (JSON arrays)
  suspects    String?
  victims     String?
  witnesses   String?
  
  evidence    String?  // JSON array
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([reportNumber])
  @@index([status])
}

model CourtCase {
  id          String   @id @default(cuid())
  
  caseNumber  String   @unique
  defendantName String
  defendantId   String? // Link to Citizen
  
  charges     String   // JSON array
  
  status      String   @default("PENDING") // PENDING, ACTIVE, SENTENCED, DISMISSED
  filedDate   DateTime
  courtDate   DateTime?
  
  prosecutor  String?
  judge       String?
  
  verdict     String?  // GUILTY, NOT_GUILTY, DISMISSED
  sentence    String?
  
  fineAmount  Float    @default(0)
  jailTime    Int      @default(0) // In months
  
  notes       String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([defendantName])
  @@index([status])
}

// ============================================
// DEPARTMENT-SPECIFIC SYSTEMS
// ============================================

model MedicalRecord {
  id          String   @id @default(cuid())
  
  patientName String
  patientId   String?  // Link to Citizen
  stateId     String?
  
  dateOfBirth String
  bloodType   String?
  
  allergies   String?  // JSON array
  medications String?  // JSON array
  conditions  String?  // JSON array
  
  emergencyContact String?
  insuranceInfo    String?
  
  lastUpdated DateTime @default(now())
  updatedBy   String
  
  createdAt   DateTime @default(now())
  
  medicalIncidents MedicalIncident[]
  
  @@index([patientName])
  @@index([stateId])
}

model MedicalIncident {
  id          String   @id @default(cuid())
  medicalRecordId String
  medicalRecord   MedicalRecord @relation(fields: [medicalRecordId], references: [id], onDelete: Cascade)
  
  callId      String?
  incidentDate DateTime
  
  chiefComplaint String
  treatment      String
  medications    String?
  
  vitalSigns     String?  // JSON: BP, HR, RR, O2, Temp
  
  transportedTo  String?
  disposition    String   // TREATED_RELEASED, TRANSPORTED, REFUSED, DOA
  
  treatedBy      String
  
  createdAt   DateTime @default(now())
  
  @@index([medicalRecordId])
}

model FirePrePlan {
  id          String   @id @default(cuid())
  
  buildingName String
  address      String   @unique
  
  buildingType String   // RESIDENTIAL, COMMERCIAL, INDUSTRIAL, HIGH_RISE
  floors       Int
  occupancy    Int?
  
  hydrantLocations String? // JSON array of coordinates
  accessPoints     String? // JSON array
  hazards          String? // JSON array
  
  blueprintUrl     String?
  notes            String?
  
  lastInspection   DateTime?
  nextInspection   DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([address])
}

model HazmatEntry {
  id          String   @id @default(cuid())
  
  chemicalName String
  unNumber     String?  // UN identification number
  class        String   // Class 1-9
  
  description  String
  hazards      String   // JSON array
  
  emergencyProcedures String
  ppe          String   // Required personal protective equipment
  
  createdAt   DateTime @default(now())
  
  @@index([chemicalName])
  @@index([unNumber])
}

model K9Unit {
  id          String   @id @default(cuid())
  
  dogName     String
  breed       String
  handlerName String
  handlerId   String?  // Link to Officer
  
  specialization String // PATROL, NARCOTICS, EXPLOSIVES, SEARCH_RESCUE
  
  certifiedDate  DateTime
  recertDate     DateTime?
  
  isActive    Boolean  @default(true)
  
  deployments K9Deployment[]
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model K9Deployment {
  id          String   @id @default(cuid())
  k9UnitId    String
  k9Unit      K9Unit   @relation(fields: [k9UnitId], references: [id], onDelete: Cascade)
  
  callId      String?
  deployedAt  DateTime
  
  purpose     String   // SEARCH, TRACK, APPREHENSION, etc.
  result      String?
  
  notes       String?
  
  createdAt   DateTime @default(now())
  
  @@index([k9UnitId])
}

// ============================================
// MDT MESSAGING & ALERTS
// ============================================

model MDTMessage {
  id          String   @id @default(cuid())
  
  fromUnitId  String
  fromCallsign String
  
  toUnitId    String?  // null for broadcast
  toCallsign  String?
  
  message     String
  priority    String   @default("NORMAL") // NORMAL, HIGH, URGENT
  
  isRead      Boolean  @default(false)
  
  createdAt   DateTime @default(now())
  
  @@index([toUnitId, isRead])
}

model SupervisorAlert {
  id          String   @id @default(cuid())
  
  type        String   // PANIC, BACKUP, PURSUIT, USE_OF_FORCE, OFFICER_DOWN
  unitId      String
  unitCallsign String
  department  String
  
  location    String?
  reason      String?
  
  status      String   @default("ACTIVE") // ACTIVE, ACKNOWLEDGED, RESOLVED
  
  acknowledgedBy String?
  acknowledgedAt DateTime?
  
  createdAt   DateTime @default(now())
  resolvedAt  DateTime?
  
  @@index([status, type])
}

// ============================================
// CIVILIAN PORTAL
// ============================================

model CivilianReport {
  id          String   @id @default(cuid())
  
  reportNumber String  @unique
  type        String   // TIP, COMPLAINT, LOST_PROPERTY, etc.
  
  reporterName  String
  reporterEmail String?
  reporterPhone String?
  
  subject     String
  description String
  location    String?
  
  status      String   @default("PENDING") // PENDING, REVIEWED, RESOLVED, DISMISSED
  
  reviewedBy  String?
  response    String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status])
}

model RecordsRequest {
  id          String   @id @default(cuid())
  
  requestNumber String  @unique
  
  requesterName  String
  requesterEmail String
  requesterPhone String?
  
  requestType    String  // POLICE_REPORT, ACCIDENT_REPORT, COURT_RECORDS
  recordDetails  String
  
  status         String  @default("PENDING") // PENDING, PROCESSING, APPROVED, DENIED, FULFILLED
  
  reviewedBy     String?
  notes          String?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([status])
}

// ============================================
// QUICK ACTIONS & TEMPLATES
// ============================================

model QuickAction {
  id          String   @id @default(cuid())
  
  name        String
  description String
  actionType  String   // STATUS_CHANGE, DISPATCH, NOTIFICATION, etc.
  
  config      String   // JSON configuration
  
  department  String?
  isActive    Boolean  @default(true)
  
  createdAt   DateTime @default(now())
}

// ============================================
// FIVEM INTEGRATION
// ============================================

model FiveMServer {
  id          String   @id @default(cuid())
  
  name        String
  ipAddress   String
  port        Int
  
  apiKey      String?
  webhookUrl  String?
  
  isActive    Boolean  @default(true)
  lastSync    DateTime?
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FiveMEvent {
  id          String   @id @default(cuid())
  
  eventType   String   // PLAYER_SHOT, VEHICLE_STOLEN, etc.
  playerId    String?
  playerName  String?
  
  location    String?
  latitude    Float?
  longitude   Float?
  
  data        String   // JSON event data
  
  autoCallCreated Boolean @default(false)
  callId          String?
  
  createdAt   DateTime @default(now())
  
  @@index([eventType, createdAt])
}

// ============================================
// ADMIN SETTINGS
// ============================================

model Setting {
  id          String   @id @default(cuid())
  
  category    String   // general, auth, notifications, cad, whitelist
  key         String   @unique
  value       String   // JSON value
  description String?
  dataType    String   @default("string") // string, number, boolean, json
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([category])
}

model DepartmentSettings {
  id          String   @id @default(cuid())
  
  department  String   @unique // POLICE, FIRE, EMS
  
  // Basic Settings
  enabled     Boolean  @default(true)
  maxUnits    Int      @default(20)
  requireCertification Boolean @default(true)
  autoApprove Boolean  @default(false)
  allowRecruitment Boolean @default(true)
  minPlaytime Int      @default(10)
  discordRole String?
  
  // Content
  description String?
  homepageContent String? // Rich text HTML
  motto       String?
  
  // Theme (JSON)
  theme       String   // JSON object with theme settings
  
  // Structure (JSON arrays)
  ranks       String   @default("[]") // JSON array of rank objects
  members     String   @default("[]") // JSON array of member objects
  
  // Dashboard Content (JSON arrays)
  announcements String  @default("[]") // JSON array of announcement objects
  events        String  @default("[]") // JSON array of event objects
  news          String  @default("[]") // JSON array of news objects
  quickStats    String  @default("[]") // JSON array of quick stat objects
  
  // Department Pages (JSON arrays)
  leadership    String  @default("[]") // JSON array of leadership profiles
  roster        String  @default("[]") // JSON array of roster entries
  sops          String  @default("[]") // JSON array of SOP documents
  stations      String  @default("[]") // JSON array of station locations
  training      String  @default("[]") // JSON array of training programs
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  @@index([department])
}

// ============================================
// CIB - CRIMINAL INVESTIGATION BRANCH
// ============================================

model Investigation {
  id              String   @id @default(cuid())
  investigationId String   @unique // INV-2025-001234
  
  title           String
  classification  String   // ASSAULT, HOMICIDE, FRAUD, THEFT, DRUGS, CORRUPTION, ORGANISED_CRIME, CYBERCRIME, OTHER
  status          String   @default("ACTIVE") // ACTIVE, DORMANT, ESCALATED, COURT_READY, CLOSED, ARCHIVED
  priority        String   @default("MEDIUM") // LOW, MEDIUM, HIGH, CRITICAL
  
  // Investigators
  primaryInvestigator   String  // Officer name or ID
  secondaryInvestigators String? // JSON array of officer names/IDs
  
  // Case Details
  summary         String
  backgroundInfo  String?
  
  // Linked Entities (JSON arrays of IDs)
  linkedPersons   String?  // Character IDs
  linkedVehicles  String?  // Vehicle registration IDs
  linkedLocations String?  // Address strings or coordinates
  linkedIncidents String?  // Incident report IDs
  linkedReports   String?  // Other report IDs
  linkedCalls     String?  // Call IDs
  
  // Court Integration
  courtCaseId     String?  // Link to CourtCase
  
  // Case Management
  startedAt       DateTime @default(now())
  lastActivityAt  DateTime @default(now())
  closedAt        DateTime?
  
  // Handover & Continuity
  handoverNotes   String?  // Notes for other investigators
  investigatorHistory String? // JSON array: [{investigator, from, to, reason}]
  
  // Prosecution Readiness
  chargeRecommendations String? // JSON array of recommended charges
  prosecutionBrief      String? // Summary for prosecution
  evidenceSummary       String? // Key evidence overview
  
  // Access Control
  securityLevel   String   @default("STANDARD") // STANDARD, CONFIDENTIAL, RESTRICTED, SECRET
  assignedTeam    String?  // CIB, DETECTIVE, MAJOR_CRIME, SPECIAL_OPS
  
  // Timeline & Activity
  timeline        InvestigationTimeline[]
  evidence        InvestigationEvidence[]
  notes           InvestigationNote[]
  tasks           InvestigationTask[]
  
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([investigationId])
  @@index([status])
  @@index([classification])
  @@index([primaryInvestigator])
  @@index([assignedTeam])
  @@index([securityLevel])
}

model InvestigationTimeline {
  id              String   @id @default(cuid())
  investigationId String
  investigation   Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  eventType       String   // CREATED, STATUS_CHANGE, EVIDENCE_ADDED, PERSON_LINKED, TASK_COMPLETED, NOTE_ADDED, HANDOVER
  description     String
  
  // Associated Data
  metadata        String?  // JSON: Additional context data
  
  performedBy     String   // Officer who performed action
  performedAt     DateTime @default(now())
  
  @@index([investigationId])
  @@index([performedAt])
}

model InvestigationEvidence {
  id              String   @id @default(cuid())
  investigationId String
  investigation   Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  evidenceNumber  String   @unique // EVD-2025-001234-001
  
  type            String   // CCTV, PHOTO, DOCUMENT, AUDIO, WITNESS_STATEMENT, PHYSICAL, DIGITAL, FORENSIC
  description     String
  
  // File/Media Information
  fileUrl         String?  // S3/CDN URL or local path
  fileName        String?
  fileType        String?  // image/jpeg, video/mp4, application/pdf
  fileSize        Int?     // In bytes
  thumbnailUrl    String?
  
  // Evidence Metadata
  collectedAt     DateTime
  collectedBy     String   // Officer name/ID
  location        String?  // Where evidence was collected
  
  // Chain of Custody
  custodyLog      String?  // JSON array: [{officer, action, timestamp}]
  isSeized        Boolean  @default(false)
  seizureAuthority String? // Warrant number or authority
  
  // Analysis
  forensicNotes   String?
  analysedBy      String?
  analysedAt      DateTime?
  
  // Status
  status          String   @default("PENDING") // PENDING, PROCESSED, ANALYSED, COURT_READY, SUPERSEDED
  isSuperseded    Boolean  @default(false)
  supersededBy    String?  // ID of newer evidence
  supersededReason String?
  
  // Relevance
  relevanceScore  Int      @default(5) // 1-10, how relevant to case
  tags            String?  // JSON array of tags
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([investigationId])
  @@index([evidenceNumber])
  @@index([type])
  @@index([status])
}

model InvestigationNote {
  id              String   @id @default(cuid())
  investigationId String
  investigation   Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  noteType        String   @default("GENERAL") // GENERAL, INTERVIEW, OBSERVATION, LEAD, THEORY, ADMIN
  content         String
  
  // Visibility & Access
  isInternal      Boolean  @default(true)  // CIB-only notes
  isImportant     Boolean  @default(false) // Flagged as important
  
  // Mentions & Assignments
  mentionedOfficers String? // JSON array of officer IDs to notify
  
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([investigationId])
  @@index([noteType])
  @@index([isImportant])
}

model InvestigationTask {
  id              String   @id @default(cuid())
  investigationId String
  investigation   Investigation @relation(fields: [investigationId], references: [id], onDelete: Cascade)
  
  title           String
  description     String?
  
  assignedTo      String   // Officer ID or name
  priority        String   @default("MEDIUM") // LOW, MEDIUM, HIGH, URGENT
  status          String   @default("PENDING") // PENDING, IN_PROGRESS, COMPLETED, CANCELLED
  
  dueDate         DateTime?
  completedAt     DateTime?
  completedBy     String?
  
  // Task Result
  result          String?  // Outcome or notes on completion
  
  createdBy       String
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([investigationId])
  @@index([assignedTo])
  @@index([status])
  @@index([dueDate])
}

// ============================================
// GENERAL DUTIES & HIGHWAY PATROL SYSTEMS
// ============================================

// Field Interactions (GD Operations)
model FieldInteraction {
  id              String   @id @default(cuid())
  
  type            String   // PERSON_STOP, VEHICLE_STOP, WELFARE_CHECK, FIELD_INTERVIEW
  location        String
  
  // Officer Details
  officerId       String?
  officerCallsign String
  unitId          String?
  
  // Involved Parties
  persons         String?  // JSON array of person details
  vehicles        String?  // JSON array of vehicle details
  
  // Outcome & Details
  outcome         String   // VERBAL_WARNING, CITATION_ISSUED, ARREST, NO_ACTION, ESCALATED
  reason          String?
  notes           String?
  
  // Escalation
  escalatedToCIB  Boolean  @default(false)
  escalationNotes String?
  
  timestamp       DateTime @default(now())
  duration        Int?     // Duration in minutes
  
  @@index([officerCallsign, timestamp])
  @@index([type])
  @@index([escalatedToCIB])
}

// Traffic Stops (Highway Operations)
model TrafficStop {
  id              String   @id @default(cuid())
  stopNumber      String   @unique // TS-2025-001234
  
  // Vehicle & Driver
  vehiclePlate    String
  vehicleId       String?
  driverName      String?
  driverLicense   String?
  
  // Stop Details
  location        String
  reason          String   // SPEEDING, RECKLESS_DRIVING, DUI, REGISTRATION, etc.
  outcome         String   // WARNING, CITATION, ARREST, IMPOUND, CLEARED
  
  // Officer Details
  officerId       String?
  officerCallsign String
  backupUnits     String?  // JSON array of backup unit callsigns
  
  // Stop Metrics
  duration        Int?     // Duration in minutes
  occupants       Int      @default(1)
  
  // Related Records
  citationIds     String?  // JSON array of citation IDs
  warningIssued   Boolean  @default(false)
  arrestMade      Boolean  @default(false)
  vehicleImpounded Boolean @default(false)
  
  // Additional Details
  notes           String?
  conditions      String?  // Weather, traffic conditions
  
  timestamp       DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([vehiclePlate])
  @@index([officerCallsign, timestamp])
  @@index([outcome])
  @@index([reason])
}

// Pursuits (Highway Operations)
model Pursuit {
  id              String   @id @default(cuid())
  pursuitNumber   String   @unique // PUR-2025-001234
  
  // Vehicle & Suspect
  vehiclePlate    String?
  vehicleDesc     String?  // Make, model, color
  suspectDesc     String?
  
  // Pursuit Details
  startLocation   String
  endLocation     String?
  route           String?  // JSON array of locations
  reason          String   // STOLEN_VEHICLE, EVADING_ARREST, DANGEROUS_DRIVING, etc.
  
  // Status & Risk
  status          String   @default("ACTIVE") // ACTIVE, ENDED, TERMINATED, CALLED_OFF
  riskLevel       String   // LOW, MEDIUM, HIGH, EXTREME
  
  // Pursuit Metrics
  peakSpeed       Int?     // km/h
  duration        Int      // Duration in minutes
  distance        Float?   // Distance in km
  
  // Units Involved
  primaryUnit     String   // Lead unit callsign
  unitsInvolved   String   // JSON array of unit callsigns
  airSupportUsed  Boolean  @default(false)
  
  // Outcome
  outcome         String?  // ARREST, CRASH, ESCAPED, CALLED_OFF, TERMINATED
  injuriesReported Boolean @default(false)
  damageReported  Boolean  @default(false)
  
  // Termination Details
  terminatedBy    String?  // Supervisor who called off pursuit
  terminationReason String?
  
  // Additional Details
  notes           String?
  tactics         String?  // JSON array of tactics used (TYRE_DEFLATION, ROAD_BLOCK, etc.)
  
  startedAt       DateTime @default(now())
  endedAt         DateTime?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([status])
  @@index([vehiclePlate])
  @@index([startedAt])
  @@index([primaryUnit])
}

// Infringements / Traffic Fines (Highway Operations)
model Infringement {
  id                  String   @id @default(cuid())
  infringementNumber  String   @unique // INF-2025-001234
  
  // Vehicle & Driver
  vehiclePlate        String
  vehicleId           String?
  driverName          String
  driverLicense       String?
  driverAddress       String?
  
  // Offence Details
  offence             String   // SPEEDING_10_20, RED_LIGHT, NO_SEATBELT, etc.
  offenceDescription  String?
  location            String
  
  // Financial
  fineAmount          Int      // Fine in dollars
  demeritPoints       Int      @default(0)
  isPaid              Boolean  @default(false)
  paidAt              DateTime?
  paymentReference    String?
  
  // Court
  courtDate           DateTime?
  courtAppearanceRequired Boolean @default(false)
  disputed            Boolean  @default(false)
  
  // Officer Details
  issuedBy            String   // Officer callsign or badge number
  witnessOfficers     String?  // JSON array of witness officers
  
  // Evidence
  photoEvidence       String?  // JSON array of photo URLs
  radarReading        Int?     // Speed in km/h if speeding offence
  videoEvidence       String?  // Video URL
  
  // Additional Details
  notes               String?
  conditions          String?  // Weather, visibility, etc.
  
  issuedAt            DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  
  @@index([vehiclePlate])
  @@index([driverName])
  @@index([isPaid])
  @@index([issuedAt])
  @@index([offence])
}

// Defect Notices (Highway Operations - ANZ specific)
model DefectNotice {
  id              String   @id @default(cuid())
  noticeNumber    String   @unique // DN-2025-001234
  
  // Vehicle
  vehiclePlate    String
  vehicleId       String?
  ownerName       String
  
  // Defect Details
  defectType      String   // LIGHTS, BRAKES, TYRES, WINDSCREEN, EMISSIONS, etc.
  severity        String   // MINOR, MAJOR, CRITICAL
  description     String
  
  // Requirements
  rectificationRequired Boolean @default(true)
  rectifyByDate   DateTime?
  reinspectionRequired Boolean @default(false)
  
  // Status
  status          String   @default("ISSUED") // ISSUED, RECTIFIED, FAILED_REINSPECTION, EXPIRED
  rectifiedAt     DateTime?
  verifiedBy      String?
  
  // Officer Details
  issuedBy        String
  location        String
  
  // Additional Details
  photoEvidence   String?  // JSON array of photo URLs
  notes           String?
  
  issuedAt        DateTime @default(now())
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([vehiclePlate])
  @@index([status])
  @@index([rectifyByDate])
}
